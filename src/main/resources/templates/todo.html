<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Todo App</title>

    <!-- Bootstrap -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet">

    <style>
        body {
            background: #eef1f6;
            min-height: 100vh;
        }

        .app-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .side-panel {
            background: linear-gradient(180deg, #4f46e5, #6366f1);
            border-radius: 20px;
            color: white;
            padding: 30px;
            height: 100%;
        }

        .todo-card {
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }

        .completed {
            text-decoration: line-through;
            color: #999;
        }

        .todo-item:hover {
            background-color: #f8f9fa;
        }

        .add-btn {
            white-space: nowrap;
            min-width: 72px;
        }

        .checkbox-btn {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            padding: 0;
            font-weight: bold;
        }

        .deadline {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .overdue {
            color: #dc3545;
            font-weight: 600;
        }
    </style>
</head>

<body>

<div class="app-wrapper">
    <div class="row g-4">

        <!-- Ï¢åÏ∏° Ìå®ÎÑê -->
        <div class="col-lg-4 d-none d-lg-block">
            <div class="side-panel">
                <h5>üìã Task Overview</h5>
                <p class="mt-3">
                    Ìï† ÏùºÏùÑ Í∏∞Ìïú Í∏∞Ï§ÄÏúºÎ°ú<br>
                    Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî.
                </p>

                <hr class="opacity-25">

                <p>
                    ‚Ä¢ Ï†ÑÏ≤¥ Ìï† Ïùº :
                    <strong th:text="${todos.size()}"></strong>
                </p>
                <p>
                    ‚Ä¢ ÏôÑÎ£å :
                    <strong th:text="${#lists.size(todos.?[completed])}"></strong>
                </p>
                <p>
                    ‚Ä¢ ÎØ∏ÏôÑÎ£å :
                    <strong th:text="${todos.size() - #lists.size(todos.?[completed])}"></strong>
                </p>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏòÅÏó≠ -->
        <div class="col-12 col-lg-8">
            <div class="card todo-card p-4">

                <!-- ÏûÖÎ†• -->
                <form th:action="@{/todo/add}" method="post" class="row g-2 mb-3">
                    <div class="col-12 col-md-6">
                        <input type="text"
                               name="title"
                               class="form-control form-control-lg"
                               placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                               required>
                    </div>

                    <div class="col-12 col-md-4">
                        <input type="date"
                               name="deadline"
                               class="form-control form-control-lg">
                    </div>

                    <div class="col-12 col-md-2 d-grid">
                        <button type="submit"
                                class="btn btn-primary btn-lg add-btn">
                            Ï∂îÍ∞Ä
                        </button>
                    </div>
                </form>

                <!-- ÏöîÏïΩ -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <small class="text-muted">
                        ÏôÑÎ£å
                        <span th:text="${#lists.size(todos.?[completed])}"></span>
                        /
                        <span th:text="${todos.size()}"></span>
                    </small>

                    <small class="text-muted"
                           th:if="${todos.size() > 0}"
                           th:text="'ÏßÑÌñâÎ•† ' + (${#lists.size(todos.?[completed])} * 100 / ${todos.size()}) + '%'">
                    </small>
                </div>

                <!-- ÏßÑÌñâÎ•† -->
                <div class="progress mb-4" th:if="${todos.size() > 0}">
                    <div class="progress-bar bg-success"
                         role="progressbar"
                         th:style="'width:' + (${#lists.size(todos.?[completed])} * 100 / ${todos.size()}) + '%'">
                    </div>
                </div>

                <!-- Î¶¨Ïä§Ìä∏ -->
                <ul class="list-group list-group-flush">
                    <li th:each="todo : ${todos}"
                        class="list-group-item d-flex justify-content-between align-items-center todo-item">

                        <div class="d-flex align-items-center">
                            <!-- Ï≤¥ÌÅ¨ -->
                            <form th:action="@{/todo/toggle/{id}(id=${todo.id})}"
                                  method="post" class="me-3">
                                <button type="submit"
                                        class="btn checkbox-btn"
                                        th:classappend="${todo.completed} ? 'btn-success' : 'btn-outline-success'">
                                    <span th:text="${todo.completed ? '‚úî' : ''}"></span>
                                </button>
                            </form>

                            <!-- Ï†úÎ™© + Í∏∞Ìïú -->
                            <div class="d-flex flex-column">
                                <span th:text="${todo.title}"
                                      th:classappend="${todo.completed} ? 'completed'"></span>

                                <span th:if="${todo.deadline != null}"
                                      class="deadline"
                                      th:classappend="${!todo.completed and todo.deadline.isBefore(T(java.time.LocalDate).now())} ? 'overdue'"
                                      th:text="'ÎßàÍ∞ê: ' + ${todo.deadline}">
                                </span>
                            </div>
                        </div>

                        <!-- ÏÇ≠Ï†ú -->
                        <form th:action="@{/todo/delete/{id}(id=${todo.id})}"
                              method="post">
                            <button class="btn btn-sm btn-outline-danger">
                                ÏÇ≠Ï†ú
                            </button>
                        </form>
                    </li>
                </ul>

            </div>
        </div>

    </div>
</div>

</body>
</html>
