<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Todo</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            min-height: 100vh;
        }

        .todo-card {
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .side-panel {
            background: rgba(255,255,255,0.6);
            border-radius: 16px;
            padding: 24px;
            height: 100%;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .completed {
            text-decoration: line-through;
            color: #999;
        }

        .checkbox-btn {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            padding: 0;
            font-weight: bold;
        }

        .add-btn {
            white-space: nowrap;
            min-width: 72px;
        }
    </style>
</head>

<body>

<div class="container mt-5">
    <div class="row g-4">

        <!-- ‚úÖ Ï¢åÏ∏° Ìå®ÎÑê (ÏôÑÏ†Ñ Î≥µÍµ¨) -->
        <div class="col-lg-4 d-none d-lg-block">
            <div class="side-panel">
                <h5>üìã Task Overview</h5>

                <p class="mt-3">
                    Ìï† ÏùºÏùÑ Í∏∞Ìïú Í∏∞Ï§ÄÏúºÎ°ú<br>
                    Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî.
                </p>

                <hr class="opacity-25">

                <p>
                    ‚Ä¢ Ï†ÑÏ≤¥ Ìï† Ïùº :
                    <strong th:text="${todos.size()}"></strong>
                </p>
                <p>
                    ‚Ä¢ ÏôÑÎ£å :
                    <strong th:text="${#lists.size(todos.?[completed])}"></strong>
                </p>
                <p>
                    ‚Ä¢ ÎØ∏ÏôÑÎ£å :
                    <strong th:text="${todos.size() - #lists.size(todos.?[completed])}"></strong>
                </p>
            </div>
        </div>

        <!-- Ïö∞Ï∏° Todo ÏòÅÏó≠ -->
        <div class="col-lg-8 col-12">
            <div class="card todo-card p-4">

                <!-- ÏûÖÎ†• -->
                <form th:action="@{/todo/add}" method="post" class="row g-2 mb-3">
                    <div class="col-6">
                        <input type="text" name="title"
                               class="form-control form-control-lg"
                               placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                    </div>

                    <div class="col-4">
                        <input type="date" name="deadline"
                               class="form-control form-control-lg">
                    </div>

                    <div class="col-2 d-grid">
                        <button class="btn btn-primary btn-lg add-btn">Ï∂îÍ∞Ä</button>
                    </div>
                </form>

                <!-- ÏßÑÌñâ ÏöîÏïΩ -->
                <div class="d-flex justify-content-between mb-3">
                    <small class="text-muted">
                        ÏôÑÎ£å
                        <span th:text="${#lists.size(todos.?[completed])}"></span>
                        /
                        <span th:text="${todos.size()}"></span>
                    </small>
                </div>

                <!-- Î¶¨Ïä§Ìä∏ -->
                <ul class="list-group list-group-flush">
                    <li th:each="todo : ${todos}"
                        th:with="today=${T(java.time.LocalDate).now()},
                                dDay=${todo.deadline != null ?
                                    T(java.time.temporal.ChronoUnit)
                                        .DAYS.between(today, todo.deadline)
                                        : 999}"
                        class="list-group-item d-flex justify-content-between align-items-center">

                        <div class="d-flex align-items-center gap-2">

                            <form th:action="@{/todo/toggle/{id}(id=${todo.id})}"
                                  method="post">
                                <button type="submit"
                                        class="btn checkbox-btn"
                                        th:classappend="${todo.completed} ? 'btn-success' : 'btn-outline-success'">
                                    <span th:text="${todo.completed ? '‚úî' : ''}"></span>
                                </button>
                            </form>

                            <span th:text="${todo.title}"
                                  th:classappend="${todo.completed} ? 'completed'"></span>

                            <span th:if="${todo.deadline != null}"
                                  class="badge"
                                  th:classappend="${dDay == 0 ? 'bg-danger' :
                                                   dDay == 1 ? 'bg-warning text-dark' :
                                                   dDay < 0 ? 'bg-dark' :
                                                   'bg-secondary'}"
                                  th:text="${dDay == 0 ? 'D-day' :
                                            dDay > 0 ? 'D-' + dDay :
                                            'ÏßÄÏó∞'}">
                            </span>
                        </div>

                        <form th:action="@{/todo/delete/{id}(id=${todo.id})}"
                              method="post">
                            <button class="btn btn-sm btn-outline-danger">ÏÇ≠Ï†ú</button>
                        </form>
                    </li>
                </ul>

            </div>
        </div>

    </div>
</div>

</body>
</html>
