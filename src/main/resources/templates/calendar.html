<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Calendar</title>

    <!-- 공통 레이아웃 CSS -->
    <link rel="stylesheet" th:href="@{/css/layout.css}">

    <!-- FullCalendar -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>

<div class="layout">

    <!-- ✅ 사이드바 유지 -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

    <!-- ✅ 메인 -->
    <div class="content">

        <h3 class="mb-4">할 일을 입력하세요</h3>

        <div id="calendar" class="panel"></div>

    </div>

</div>

<!-- ✅ 일정 등록 모달 -->
<div class="modal fade" id="todoModal" tabindex="-1">
    <div class="modal-dialog">
        <form method="post" th:action="@{/todoNew}">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">할 일 등록</h5>
                    <button type="button" class="btn-close"
                            data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <!-- 선택한 날짜 저장 -->
                    <input type="hidden" name="dueDate" id="selectedDate">

                    <div class="mb-3">
                        <input type="text"
                               name="title"
                               class="form-control"
                               placeholder="할 일을 입력하세요"
                               required>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>

            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        const calendarEl = document.getElementById('calendar');

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            height: 650,
            events: '/api/calendar/todo',

            // ✅ 날짜 클릭 시 모달 열기
            dateClick: function(info) {

                // 선택 날짜 hidden input에 세팅
                document.getElementById("selectedDate").value = info.dateStr;

                // 모달 열기
                const modal = new bootstrap.Modal(
                    document.getElementById('todoModal')
                );
                modal.show();
            }
        });

        calendar.render();
    });
</script>

</body>
</html>
